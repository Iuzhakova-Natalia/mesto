(()=>{"use strict";class e{constructor(e,t,s,r,{handleLikeClick:i,handleDeleteClick:n}){this._name=e.name,this._link=e.link,this._likes=e.likes,this._cardId=e._id,this._ownerId=e.owner._id,this._userId=t,this._templateSelector=s,this._handleCardClick=r,this._handleLikeClick=i,this._handleDeleteClick=n}_getCardElement(){return document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0)}putLike(e){this._likeCounter.textContent=e.length,this._buttonLike.classList.add("card__like_active"),this.isLiked=!0}deleteLike(e){this._buttonLike.classList.remove("card__like_active"),this._likeCounter.textContent=e.length,this._isLiked=!1}deleteCard(){this._card.remove(),this._card=null}_setEventListeners(){this._buttonDelete.addEventListener("click",(()=>{this._handleDeleteClick(this._cardId)})),this._buttonLike.addEventListener("click",(()=>{this._handleLikeClick(this._cardId,this._isLiked)})),this._cardImage.addEventListener("click",(()=>{this._handleCardClick(this._cardImage.src,this._cardImage.alt)}))}generateCard(){return this._card=this._getCardElement(),this._cardImage=this._card.querySelector(".card__image"),this._cardName=this._card.querySelector(".card__name"),this._buttonDelete=this._card.querySelector(".card__delete"),this._buttonLike=this._card.querySelector(".card__like"),this._likeCounter=this._card.querySelector(".card__like-counter"),this._likeCounter.textContent=this._likes.length,this._likes.some((e=>e._id===this._ownerId))?(this._isLiked=!0,this._buttonLike.classList.add("card__like_active")):(this._isLiked=!1,this._buttonLike.classList.remove("card__like_active")),this._ownerId!==this._userId&&this._buttonDelete.remove(),this._setEventListeners(),this._cardName.textContent=this._name,this._cardImage.alt=this._name,this._cardImage.src=this._link,this._card}}class t{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class s extends t{constructor(e,t){super(e),this._handleSubmitForm=t,this._inputList=this._popup.querySelectorAll(".form__input-text"),this._form=this._popup.querySelector(".form"),this._buttonSubmit=this._form.querySelector(".form__button"),this._initialButtonText=this._buttonSubmit.textContent}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmitForm(this._getInputValues())}))}close(){super.close(),this._form.reset()}renderLoading(e){this._buttonSubmit.textContent=e?"Сохранение...":this._initialButtonText}}class r{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_showInputError(e){const t=this._formElement.querySelector(`.${e.id}-error`);t.textContent=e.validationMessage,t.classList.add(this._errorClass),e.classList.add(this._inputErrorClass)}_hideInputError(e){const t=this._formElement.querySelector(`.${e.id}-error`);t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._inputErrorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_disableButton(){this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)}_enableButton(){this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled")}_toggleButtonState(){this._hasInvalidInput()?this._disableButton():this._enableButton()}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))})),this._formElement.addEventListener("submit",(e=>{e.preventDefault()}))}resetValidation(){this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._setEventListeners()}}const i={inputSelector:".form__input-text",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__input-text_type_error-line",errorClass:"form__input-error_active"},n=document.querySelector(".profile__button_type_edit"),o=document.querySelector(".profile__add-button"),a=document.querySelector(".profile__ava-button"),h=document.forms["form-edit-profile"],l=document.forms["form-avatar"],c=document.forms["form-add-card"];let _;const d=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then(this._checkResponse)}patchUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}patchAvatar({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}getCards(){return fetch(`${this._baseUrl}/cards`,{method:"GET",headers:this._headers}).then(this._checkResponse)}postCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}putLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}deleteLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-64",headers:{authorization:"a24e7087-a96b-4b2b-8905-f0302e2d2b76","Content-Type":"application/json"}});d.getUserInfo().then((e=>{m.setUserInfo(e),_=e._id})).catch((e=>{console.log(`Ошибка: ${e}`)}));const u=(e,t)=>{E.open(e,t)},p=t=>{const s=new e(t,_,"#card-template",u,{handleLikeClick:(e,t)=>{t?d.deleteLike(e).then((e=>{s.deleteLike(e.likes)})).catch((e=>{console.log(`Ошибка: ${e}`)})):d.putLike(e).then((e=>{s.putLike(e.likes)})).catch((e=>{console.log(`Ошибка: ${e}`)}))},handleDeleteClick:e=>{v.open(),v.handleSubmit((()=>{d.deleteCard(e).then((e=>{s.deleteCard(e._id),v.close()})).catch((e=>{console.log(`Ошибка: ${e}`)}))}))}}),r=s.generateCard();b.addItem(r)};d.getCards().then((e=>{b.renderItems(e)})).catch((e=>{console.log(`Ошибка: ${e}`)}));const m=new class{constructor(e,t,s){this._userName=document.querySelector(e),this._userAbout=document.querySelector(t),this._userAvatar=document.querySelector(s)}getUserInfo(){const e={};return e.name=this._userName.textContent,e.about=this._userAbout.textContent,e}setUserInfo({name:e,about:t}){this._userName.textContent=e,this._userAbout.textContent=t,this._userAvatar.src=avatar}setUserAvatar({avatar:e}){this._userAvatar.src=e}}(".profile__name",".profile__about",".profile__avatar"),b=new class{constructor({renderer:e},t){this._renderer=e,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({renderer:p},".cards-container"),L=new s(".popup_tupe_edit",(e=>{L.renderLoading(!0),d.patchUserInfo(e).then((e=>{m.setUserInfo(e),L.close()})).catch((e=>{console.log(`Ошибка: ${e}`)})).finally((()=>{L.renderLoading(!1)}))})),k=new s(".popup_type_avatar",(e=>{k.renderLoading(!0),d.patchAvatar(e).then((e=>{m.setUserAvatar(e),k.close()})).catch((e=>{console.log(`Ошибка: ${e}`)})).finally((()=>{k.renderLoading(!1)}))})),v=new class extends t{constructor(e){super(e),this._form=this._popup.querySelector(".form")}handleSubmit(e){this._submitHandler=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler()}))}}(".popup_type_delete-card"),f=new s(".popup_type_new-place",(e=>{f.renderLoading(!0),d.postCard(e).then((e=>{p(e),f.close()})).catch((e=>{console.log(`Ошибка: ${e}`)})).finally((()=>{f.renderLoading(!1)}))})),E=new class extends t{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._place=this._popup.querySelector(".popup__place")}open(e,t){this._image.src=e,this._image.alt=t,this._place.textContent=t,super.open()}}(".popup_type_image"),C=new r(i,h),g=new r(i,c),y=new r(i,l);C.enableValidation(),g.enableValidation(),y.enableValidation(),n.addEventListener("click",(()=>{const{name:e,about:t}=m.getUserInfo();h.name.value=e,h.about.value=t,C.resetValidation(),L.open()})),o.addEventListener("click",(()=>{g.resetValidation(),f.open()})),a.addEventListener("click",(()=>{y.resetValidation(),k.open()})),L.setEventListeners(),k.setEventListeners(),v.setEventListeners(),f.setEventListeners(),E.setEventListeners()})();
//# sourceMappingURL=main.js.map